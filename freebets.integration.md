# Freebets API Documentation

## Authentication

### Overview

All API requests require authentication to ensure that only authorized providers can access and modify data. Authentication is handled via headers that need to be included in every API request.

### Authentication token generation (Node JS Example)

```js
const crypto = require("crypto");

const PUBLIC_KEY = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyuJohz5bY4sdIMEs/SZj
YtpR7tuXD6Owb1DntJxDlqgB610ipf9CSgxRRnwuZJ5pDAznyCwRQxghrx0MEr+j
zpRRhN5Ztp09QRA7LvDJY/mKblp9yzu2TnrlszVc8t/wohEw3SGvoUJk8srz6q+9
04wIA8iBinBxseLHbAHMSdVzy+bZIS/jGuzaCAOE+eKSJje8rDB3Bil1ZyBuRU/5
4XEhdHoiRFjBGftqNGFC7AKPI8UkIyYf+E8BsOEpzjIQYEOHpiujw/zfgBKpesJK
iSffuYhOVpvLEaTddchopE7KZ7k3/1hbODydWLkP8kdXqStj8Li23+6Whf6H6Idu
kQIDAQAB
-----END PUBLIC KEY-----
`;

const PROVIDERID = "66570824f6f0265284c51421";

async function encryptMessage(publicKey, message) {
  try {
    const bufferMessage = Buffer.from(message, "utf8");
    const encryptedMessage = crypto.publicEncrypt(
      {
        key: publicKey,
        padding: crypto.constants.RSA_PKCS1_OAEP_PADDING,
        oaepHash: "sha256",
      },
      bufferMessage
    );
    return encryptedMessage.toString("base64");
  } catch (error) {
    console.error("Encryption failed:", error.message);
  }
}

const payload = {
  // timestamp defined by provider
  timestamp: new Date().getTime(),
};

encryptMessage(PUBLIC_KEY, JSON.stringify(payload)).then((token) => {
  console.log("TOKEN:", token);
});
```

### Required Headers

- **x-provider-token**: A token generated by the provider's public key. This token is used to authenticate the provider and ensure the request is coming from a trusted source.
- **x-provider-id**: The unique identifier of the provider. This ID is used to identify the provider making the request.

## Campaign Creation

### Endpoint: Create a New Campaign

This endpoint allows providers to create a new freebets campaign. The campaign includes details such as the start date, end date, unique campaign identifier, and a description.

**URL:** `/api/campaigns`

**Method:** `POST`

**Headers:**

- `x-provider-token`: Token generated by the provider's public key.
- `x-provider-id`: The identifier of the provider.

**Request Body:**

```json
{
  "startDate": "2024-08-01T08:11:54.782Z",
  "endDate": "2024-09-01T08:11:54.782Z",
  "campaignUniqueId": "6ff0c6d0-0689-4927-a898-919e9bba55d7",
  "description": "Signup Super Duper Bonus Campaign"
}
```

- **startDate**: The start date of the campaign in ISO 8601 date format.
- **endDate**: The end date of the campaign in ISO 8601 date format.
- **campaignUniqueId**: A unique identifier for the campaign as defined by the provider.
- **description**: A brief description of the campaign.

**Response:**

```json
{
  "campaignId": "unique-campaign-id"
}
```

- **campaignId**: The unique identifier assigned to the campaign by the API.

## Freebet Creation

### Endpoint: Populate Campaign with Player Freebets

This endpoint allows providers to add freebets to an existing campaign. Freebets are assigned to specific players and include details such as validity date, bet nominal, and other parameters.

**URL:** `/api/campaigns/{campaignId}/freebets`

**Method:** `POST`

**Headers:**

- `x-provider-token`: Token generated by the provider's public key.
- `x-provider-id`: The identifier of the provider.

**Request Body:**

```json
{
  "playerIds": ["1", "2", "3", "4"],
  "validityDate": "2024-08-01T08:11:54.782Z",
  "count": 1,
  "minMultiplier": 1.25,
  "betNominal": 2.25,
  "requestId": "8ced1e2f-78ea-4491-91ea-22916ed054d1"
}
```

- **playerIds**: A list of player IDs to whom the freebets will be granted. Maximum 1000 player IDs per request.
- **validityDate**: The date until which the freebets are valid, in ISO 8601 date format.
- **count**: The number of freebets to be granted to each player.
- **minMultiplier**: The minimum target multiplier required for the freebet to be cashed out.
- **betNominal**: The nominal value of each freebet.
- **requestId**: A unique identifier for the bulk freebet creation request.

**Response:**

```json
[
  {
    "playerId": "1",
    "freebetId": "66a9e865a78afa53c3075162"
  },
  {
    "playerId": "2",
    "freebetId": "66a9e865a78afa53c3075163"
  }
]
```

- **playerId**: The ID of the player to whom the freebet was granted.
- **freebetId**: The unique identifier of the freebet.

## Revoke and Data Retrieval

### Endpoint: Fetch Provider Active Freebets

This endpoint retrieves the active freebets created by the current provider. It supports pagination to handle large sets of data.

**URL:** `/api/freebets`

**Method:** `GET`

**Headers:**

- `x-provider-token`: Token generated by the provider's public key.
- `x-provider-id`: The identifier of the provider.

**Parameters:**

- **page**: The page number to retrieve (required).
- **limit**: The number of items per page (required).

**Response:**
Returns a list of active freebets created by the current provider. Max Limit of 1000 records

```json
{
  "page": 1,
  "limit": 100,
  "total": 100,
  "docs": []
}
```

### Endpoint: Revoke Campaign

This endpoint allows the provider to revoke access to player freebets in the current campaign context or revoke the entire campaign.

**URL:** `/api/campaigns/{campaignId}`

**Method:** `DELETE`

**Headers:**

- `x-provider-token`: Token generated by the provider's public key.
- `x-provider-id`: The identifier of the provider.

**Request Body:**

1. Revoke Entire Campaign. Required

```json
{
  "isFullRevoke": false
}
```

2. Revoke bulk freebets with request ID. Required

```json
{
  "requestId": "4497348f-818f-44d9-bc19-1d138bb20524"
}
```

4. Revoke bulk freebets with player Ids. Required (Max 1000)

```json
{
  "playerIds": ["1", "2", "3"]
}
```

- **playerIds**: A list of player IDs whose freebets are to be revoked
- **isFullRevoke**: A boolean indicating whether to revoke the entire campaign.
- **requestId**: The unique identifier of the revoke request.

**Response:**

```json
{
  "status": true
}
```

- **status**: Indicates whether the revoke operation succeeded.

### Endpoint: Revoke Specific Freebet from Campaign

This endpoint revokes a specific freebet from a target campaign.

**URL:** `/api/campaigns/{campaignId}/{campaignFreeBetId}`

**Method:** `DELETE`

**Headers:**

- `x-provider-token`: Token generated by the provider's public key.
- `x-provider-id`: The identifier of the provider.

**Response:**

```json
{
  "status": true
}
```

- **status**: Indicates whether the revoke operation succeeded.

### Endpoint: Update Campaign End Date

This endpoint allows the provider to update the end date of an existing campaign.

**URL:** `/api/campaigns/{campaignId}`

**Method:** `PUT`

**Headers:**

- `x-provider-token`: Token generated by the provider's public key.
- `x-provider-id`: The identifier of the provider.

**Request Body:**

```json
{
  "endDate": "2024-10-01T08:11:54.783Z"
}
```

- **endDate**: The new end date for the target campaign in ISO 8601 date format.

**Response:**

```json
{
  "status": true
}
```

- **status**: Indicates whether the update operation succeeded.
